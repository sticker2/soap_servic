# soap_service

это веб-сервис, который принимает арифметические выражения через HTTP-запросы и вычисляет их с использованием распределённой архитектуры. В проекте используется оркестратор, который распределяет задачи между агентами для выполнения вычислений.

## Инструкция по запуску

### Убедитесь, что у вас установлен Go (версия 1.16 или выше).

### Клонируйте репозиторий:

```bash
git clone https://github.com/sticker2/soap_service
cd soap_service
```

### Запустите сервер:

```bash
go run ./cmd/orchestrator/...
```

После этого сервер будет доступен по адресу: `http://localhost:8081/api/v1/calculate`.

---

## Примеры использования (с помощью программы Postman)

### 1. Добавление арифметического выражения для вычисления

**Запрос**:

```bash
POST http://localhost:8081/api/v1/calculate
Content-Type: application/json
{
  "expression": "<строка с выражением>"
}
```

**Ответ**:

- **201 Created**: Выражение принято для вычисления.

```json
{
  "id": <идентификатор выражения>
}
```

- **422 Unprocessable Entity**: Невалидные данные (например, пустое или некорректное выражение).

```json
{
  "error": "invalid input"
}
```

- **500 Internal Server Error**: Ошибка на сервере.

---

### 2. Получение списка выражений

**Запрос**:

```bash
GET http://localhost:8081/api/v1/expressions
```

**Ответ**:

- **200 OK**: Успешно получен список выражений.

```json
{
  "expressions": [
    {
      "id": <идентификатор выражения>,
      "status": <статус вычисления выражения>,
      "result": <результат выражения>
    }
  ]
}
```

- **500 Internal Server Error**: Ошибка на сервере.

---

### 3. Получение выражения по его идентификатору

**Запрос**:

```bash
GET http://localhost:8081/api/v1/expressions/{id}
```

**Ответ**:

- **200 OK**: Успешно получено выражение.

```json
{
  "expression": {
    "id": <идентификатор выражения>,
    "status": <статус вычисления выражения>,
    "result": <результат выражения>
  }
}
```

- **404 Not Found**: Выражение с таким идентификатором не найдено.

```json
{
  "error": "expression not found"
}
```

- **500 Internal Server Error**: Ошибка на сервере.

---

### 4. Получение задачи для выполнения

**Запрос**:

```bash
GET http://localhost:8081/internal/task
```

**Ответ**:

- **200 OK**: Успешно получена задача.

```json
{
  "task": {
    "id": <идентификатор задачи>,
    "arg1": <имя первого аргумента>,
    "arg2": <имя второго аргумента>,
    "operation": <операция>,
    "operation_time": <время выполнения операции>
  }
}
```

- **404 Not Found**: Нет доступных задач.

```json
{
  "error": "no tasks"
}
```

- **500 Internal Server Error**: Ошибка на сервере.

---

### 5. Приём результата обработки данных

**Запрос**:

```bash
POST http://localhost:8081/internal/task
Content-Type: application/json
{
  "id": <идентификатор задачи>,
  "result": <результат вычисления>
}
```

**Ответ**:

- **200 OK**: Успешно записан результат.

```json
{
  "message": "result recorded"
}
```

- **404 Not Found**: Задача с таким идентификатором не найдена.

```json
{
  "error": "task not found"
}
```

- **422 Unprocessable Entity**: Невалидные данные.

```json
{
  "error": "invalid input"
}
```

- **500 Internal Server Error**: Ошибка на сервере.

---

## Коды ошибок

- **200 ОК**:  успешно записан результат
- **422 Unprocessable Entity**: Невалидные входные данные.
- **404 Not Found**: Запрашиваемый ресурс (выражение или задача) не найден.
- **500 Internal Server Error**: Ошибка на сервере.

---
